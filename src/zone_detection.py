

def detect_zone(lat, lon):
    # На выходе название зоны и ориентировочное расстояние до неё в метрах.
    
    from shapely.geometry import Point
    from shapely.geometry.polygon import Polygon
    # Latitude 43-45 (широта)
    # Longitude 36-39 (долгота)
    point = Point(lat, lon)
    # тут polygones - хардкод, но в случае изменения зон их можно и просто перечитать из файла (см. блоки выше)
    polygones = {0: {'name': 'Зона 1 - Большой Утриш', 'coordinates': [(44.758175830862115, 37.386591152135395), (44.75894789725383, 37.38439174074315), (44.76124874640571, 37.38652141470102), (44.76226919313874, 37.38659651655347), (44.76296858997696, 37.38635511774213), (44.76377880953951, 37.385722116414655), (44.76461194793484, 37.38503547090687), (44.76518902294305, 37.38566310781637), (44.7646769169343, 37.387513832036646), (44.7650055824698, 37.38850088495414), (44.765510042249346, 37.389182166043895), (44.76587309765932, 37.38901586908498), (44.7662743667577, 37.38807709592977), (44.76636608501933, 37.387068585340174), (44.766018319168005, 37.386698440496126), (44.76613296748378, 37.385866955701495), (44.76652468071334, 37.38531442064455), (44.76644562369537, 37.38499348243879), (44.76612078797584, 37.38504444441006), (44.765782574693525, 37.38585983595058), (44.765608690262994, 37.38658671459362), (44.76594881535964, 37.387573767511114), (44.765666143903424, 37.388577792322444), (44.7651234687696, 37.38793674436788), (44.76539289617023, 37.38728228536825), (44.76543875600378, 37.38655808893423), (44.76572155760464, 37.385420832311944), (44.765436845137025, 37.38491389480817), (44.76447378048068, 37.384417686140424), (44.76385656983078, 37.38476905552138), (44.762914498529604, 37.3853769111394), (44.76255142439965, 37.38561294553272), (44.76216159483995, 37.38590262410637), (44.761068529283165, 37.38490484235275), (44.75962493967421, 37.3834858246759), (44.75909746510221, 37.38169205150055), (44.7587458330992, 37.38071572741913), (44.757736790172686, 37.380179285616165), (44.75665128481313, 37.38048505744384), (44.75643723909576, 37.38133799991058), (44.75683475195284, 37.38188517054962), (44.75800434118197, 37.382228493303515), (44.758417699209936, 37.38321804228549), (44.7584727537918, 37.384593352682586), (44.757869684239, 37.386268497580495), (44.758175830862115, 37.386591152135395)]}, 1: {'name': 'Зона 2 - Сукко - 1', 'coordinates': [(44.78204384661924, 37.38231315304534), (44.78113674791483, 37.38216492427537), (44.77935411852615, 37.38252772976657), (44.77510531383131, 37.3829997985532), (44.770593186046014, 37.383833061452805), (44.76804491798146, 37.38460354957982), (44.76698512387844, 37.38436582539165), (44.766442461219505, 37.38485935185038), (44.76671582628296, 37.38601994747935), (44.767680764019566, 37.3856444382173), (44.770432180645244, 37.385301115463406), (44.77206004003643, 37.38503289456186), (44.773777922302, 37.38578590381114), (44.77496639739008, 37.385241185511525), (44.77674014201985, 37.385639346984746), (44.77904430409331, 37.3851091710663), (44.78038792291078, 37.3838695272364), (44.781115111369125, 37.3832745401001), (44.78271974456766, 37.38373588005063), (44.78505020329753, 37.381976350936874), (44.78573786156653, 37.3814184514618), (44.78707495121972, 37.38054941574086), (44.78615093857453, 37.37877798313914), (44.78595992459768, 37.37875652546703), (44.78539436830748, 37.37973286797307), (44.78469906515964, 37.38024785210388), (44.78204384661924, 37.38231315304534)]}, 2: {'name': 'Зона 3 - Сукко - 2', 'coordinates': [(44.79218297102406, 37.3742148567543), (44.792100843974275, 37.3738259364469), (44.79065118238908, 37.37442675126629), (44.78863420099638, 37.37544599069194), (44.787136699215516, 37.37623992456036), (44.78619692047028, 37.377516656051455), (44.78612051499709, 37.37858953965739), (44.78712141836344, 37.380445628295696), (44.787633324038836, 37.38133612168864), (44.78877936490573, 37.379962830673016), (44.78940585756161, 37.379093794952155), (44.790039983359904, 37.37732085479336), (44.789575849734526, 37.376827328334656), (44.78987381244787, 37.376376717220154), (44.7913750626221, 37.376001207958105), (44.79159279793838, 37.375572054515764), (44.79236823450036, 37.375099985729214), (44.79218297102406, 37.3742148567543)]}, 3: {'name': 'Зона 4 - Шингари - 1', 'coordinates': [(44.79212567334809, 37.373729838409155), (44.79250001988233, 37.37547863868685), (44.79316848991652, 37.37485100177725), (44.793428236107324, 37.37398196605642), (44.7946505553613, 37.373488439597686), (44.79665204682869, 37.37227876333197), (44.79873393894674, 37.37100039999821), (44.799925590183925, 37.36902629416325), (44.8000474947286, 37.368804230488735), (44.79949750609869, 37.36773939350981), (44.794569623626664, 37.37177306291919), (44.79212567334809, 37.373729838409155)]}, 4: {'name': 'Зона 5 - Шингари - 2', 'coordinates': [(44.80343058779298, 37.364052121607294), (44.79946122763565, 37.36759686348243), (44.80011242926811, 37.368857501719475), (44.800723520903155, 37.36750298616692), (44.80364903168025, 37.364938794348646), (44.80655358922704, 37.36258165899159), (44.80627651728377, 37.36182743189133), (44.80343058779298, 37.364052121607294)]}, 5: {'name': 'Зона 6 - Шингари - 3', 'coordinates': [(44.840316431501414, 37.34073800854901), (44.83191152356392, 37.339257429172704), (44.82687256746387, 37.34096331410617), (44.82203933379921, 37.34509391598907), (44.819886008329895, 37.34590930752961), (44.81414341111294, 37.35464258008206), (44.80614193403646, 37.36135638171349), (44.806705391339925, 37.3628793841918), (44.814386600629774, 37.35681222740005), (44.82052624502287, 37.34724210563488), (44.82306132904319, 37.34672712150404), (44.82761198148561, 37.34277890983401), (44.83451362301631, 37.34200643363773), (44.845933095875154, 37.34398053947269), (44.856663491292906, 37.334303129346836), (44.85601602701126, 37.33280939870114), (44.847613424931154, 37.33899993710744), (44.84362896787695, 37.340780923892915), (44.840316431501414, 37.34073800854901)]}, 6: {'name': 'Зона 7 - Супсех (200-800 ступеней) 40 лет Победы', 'coordinates': [(44.856115002735436, 37.332712839175564), (44.85681707044175, 37.334322164584506), (44.86110560128004, 37.32919378094804), (44.86789257427344, 37.32206983380443), (44.86737734042187, 37.3208585543485), (44.856115002735436, 37.332712839175564)]}, 7: {'name': 'Зона 8 - Анапа Высокий берег 1', 'coordinates': [(44.86728410704012, 37.320478723778855), (44.86801655614578, 37.32213096453208), (44.87652296027765, 37.31182055307868), (44.875676191157396, 37.310050295128875), (44.86728410704012, 37.320478723778855)]}, 8: {'name': 'Зона 9 - Анапа Высокий берег 2', 'coordinates': [(44.875611348384965, 37.30966167243733), (44.87662594530432, 37.31172160896076), (44.87856354654369, 37.30925397666704), (44.88185884346452, 37.30682925971756), (44.8855200615959, 37.30279521735916), (44.888509882393144, 37.299490735852814), (44.89131269736229, 37.29765074046851), (44.89091918485994, 37.29572229879014), (44.88829223993239, 37.296723083850196), (44.88381342932553, 37.30129356801146), (44.881372570404075, 37.304211811419655), (44.878330609792386, 37.30691547810672), (44.87694824793708, 37.30792398869611), (44.875611348384965, 37.30966167243733)]}, 9: {'name': 'Зона 10 - Анапа Малая бухта санаторий Русь', 'coordinates': [(44.89519255789183, 37.298053459521206), (44.89425455190148, 37.298053459521206), (44.893484307859374, 37.29744191586579), (44.89388087043585, 37.29680891453829), (44.89368258948183, 37.29615445553864), (44.892683548071076, 37.296315388079535), (44.89254150768137, 37.296912179585085), (44.89301147960746, 37.29861135899628), (44.89419354284957, 37.29926581799593), (44.89537558163127, 37.29916925847138), (44.89666023673906, 37.29862961448825), (44.89642764915543, 37.29691836513678), (44.896156931290015, 37.296977373735125), (44.89630944855511, 37.2982541052262), (44.89538289989187, 37.29878518261114), (44.89519255789183, 37.298053459521206)]}, 10: {'name': 'Зона 11 - Анапа центральный пляж', 'coordinates': [(44.89773223257756, 37.31085296093995), (44.89637484841392, 37.31201167523436), (44.89838803586024, 37.31492991864258), (44.90184994223749, 37.31767650067383), (44.90514066161489, 37.31968488752258), (44.90537052733536, 37.31957752053976), (44.905889000721764, 37.31361228769064), (44.89773223257756, 37.31085296093995)]}, 11: {'name': 'Зона 12 - Анапа устье реки Анапка', 'coordinates': [(44.90586718159444, 37.316392037505636), (44.90542495438105, 37.31967506133998), (44.90686599239567, 37.320715758437736), (44.91442893944832, 37.31998619758566), (44.91968886631184, 37.318897220725596), (44.919079044567795, 37.315480086440616), (44.91459665479973, 37.316767546767814), (44.90927557383763, 37.316822924381704), (44.90586718159444, 37.316392037505636)]}, 12: {'name': 'Зона 13 - Анапа Джемете 1', 'coordinates': [(44.919067610594205, 37.31519214130041), (44.919765093837746, 37.31914035297028), (44.933716778724786, 37.30922690845124), (44.94091041442258, 37.30270377612691), (44.942312458118586, 37.30388394809341), (44.943089663121654, 37.30221024966808), (44.94445736585122, 37.29997060514061), (44.94062466766016, 37.295697846179934), (44.93548711818641, 37.30176107799851), (44.93140231918704, 37.298842834590346), (44.93121941093876, 37.30678217327435), (44.919067610594205, 37.31519214130041)]}, 13: {'name': 'Зона 14 - Анапа Джемете 2', 'coordinates': [(44.94155048255999, 37.29660050785373), (44.94469737752029, 37.300162481425495), (44.95196581248561, 37.29272739803623), (44.95543208772874, 37.289315628169255), (44.95340567550924, 37.285742925761355), (44.94155048255999, 37.29660050785373)]}, 14: {'name': 'Зона 15 - Анапа Джемете 3 Черноморец', 'coordinates': [(44.95345519403816, 37.28563563740078), (44.95558063774867, 37.28936927234949), (44.95989222636815, 37.2847129574996), (44.96782896232846, 37.27319018757162), (44.96627521621121, 37.27055089390098), (44.95345519403816, 37.28563563740078)]}, 15: {'name': 'Зона 16 - Витязево ул Черноморская (Юг)', 'coordinates': [(44.966294257620994, 37.27035777485178), (44.96815265425033, 37.273533510325414), (44.98373338207156, 37.251475023386824), (44.98215307231134, 37.248704552884966), (44.98000577562498, 37.246344208951854), (44.966294257620994, 37.27035777485178)]}, 16: {'name': 'Зона 17 - Витязево ул Черноморская (Север)', 'coordinates': [(44.979933783425096, 37.24612963223059), (44.982176262682444, 37.248688459630785), (44.98375477108545, 37.25139244178882), (44.988669505443966, 37.24287911037551), (44.993762717471164, 37.23661078790767), (44.98892075083692, 37.23162456134903), (44.979933783425096, 37.24612963223059)]}, 17: {'name': 'Зона 18 - Витязевская пересыпь природный парк Анапская пересыпь до Благовещенской', 'coordinates': [(45.04132449733213, 37.11092402215958), (45.02132088863037, 37.161603245590406), (45.003601726806124, 37.20153681302499), (44.98886315734187, 37.23142439179345), (44.999901642491544, 37.24288278870507), (45.006384861784376, 37.23040034051899), (45.02446606422066, 37.19649721857074), (45.03292633610204, 37.16516901727676), (45.05731378899352, 37.08583578354975), (45.06729837327604, 37.051075841146854), (45.06067819354809, 37.04918070415582), (45.04132449733213, 37.11092402215958)]}, 18: {'name': 'Зона 19 - Веселовка, Бугазская коса', 'coordinates': [(45.06144096560169, 37.04854361081548), (45.06591180943976, 37.049959817175335), (45.07004778689495, 37.03056208157962), (45.07670729391819, 37.000821748022446), (45.079869525934015, 36.99481359982909), (45.081085722105804, 36.98580137753907), (45.10388457488763, 36.91258780026855), (45.109020651543, 36.89555040860592), (45.116496955458075, 36.85436721207785), (45.11340420085886, 36.85347161360432), (45.10623235398233, 36.88844761915846), (45.074860061009815, 36.99281773634597), (45.06549365103233, 37.02886662550608), (45.06144096560169, 37.04854361081548)]}}
    
    polyzones = {}
    for pg in polygones:
        polyzones[pg] = {'name': polygones[pg]['name'], 'polygon': Polygon(polygones[pg]['coordinates'])} # почему-то только 3 знака после запятой (!) потребуется пофиксить
    
    # приведем приблизительный коэффициент перевода градусов в метры
    koef_to_meters = 87700
    min_dist = 999999
    closest_zone = 100
    zone_defined = 0
    for z in polyzones:
        if polyzones[z]['polygon'].contains(point) == True:
            min_dist = 0
            closest_zone = z
            zone_defined = 1
        elif (zone_defined == 0):
            if min_dist > point.distance(polyzones[z]['polygon']):
                min_dist = point.distance(polyzones[z]['polygon'])
                closest_zone = z
    
    min_dist_meters = int(min_dist*koef_to_meters)
    
    return(polyzones[closest_zone]['name'], min_dist_meters)